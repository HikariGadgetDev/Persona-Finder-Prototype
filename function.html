<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title id="page-title">èªçŸ¥æ©Ÿèƒ½ã®è©³ç´° â€” Persona Checker</title>
  <meta name="description" id="page-description" content="èªçŸ¥æ©Ÿèƒ½ã®æ·±å±¤åˆ†æ">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/function.css">
</head>
<body>
  <header class="header">
    <div class="header-content">
      <a href="index.html" class="back-link">
        <span>â†</span>
        <span>æˆ»ã‚‹</span>
      </a>
      <div class="header-logo">Î¨</div>
    </div>
  </header>

  <section class="hero">
    <div class="function-badge">
      <span class="function-code" id="hero-code">--</span>
      <span class="function-name" id="hero-name">èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>
    <h1 class="tagline" id="hero-tagline">èªçŸ¥æ©Ÿèƒ½ã®æ·±å±¤åˆ†æ</h1>
    <div class="tags" id="hero-tags"></div>
  </section>

  <main class="container" id="main-content">
    <div class="info-box">
      <div class="info-title">ğŸ“– èª­ã¿è¾¼ã¿ä¸­...</div>
      <div class="info-content">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚å°‘ã€…ãŠå¾…ã¡ãã ã•ã„ã€‚</div>
    </div>
  </main>

  <footer class="footer">
    <p class="footer-text">Persona Checker - èªçŸ¥æ©Ÿèƒ½åˆ†æ</p>
    <p class="footer-note">
      ã“ã®ãƒšãƒ¼ã‚¸ã¯ Carl Jung ã®èªçŸ¥æ©Ÿèƒ½ç†è«–ã‚’åŸºã«ã—ãŸåˆ†æã§ã™ã€‚
      ç§‘å­¦çš„å¦¥å½“æ€§ã¯é™å®šçš„ã§ã‚ã‚Šã€è‡ªå·±ç†è§£ã®è£œåŠ©çš„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚
    </p>
  </footer>
<script>
  const params = new URLSearchParams(location.search);
  const code = (params.get('code') || params.get('func') || 'se').toLowerCase();

  async function loadData() {
    try {
      console.log('Loading:', code);
      const res = await fetch(`data/${code}.json`);
      console.log('Response status:', res.status);
      
      if (!res.ok) throw new Error(`${code}.json ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ (Status: ${res.status})`);
      
      const data = await res.json();
      console.log('Data loaded:', data);

      // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š
      document.getElementById('page-title').textContent = 
        `${data.name}ï¼ˆ${data.code}ï¼‰å®Œå…¨ã‚¬ã‚¤ãƒ‰ â€” Persona Checker`;

      // ãƒ’ãƒ¼ãƒ­ãƒ¼
      document.getElementById('hero-code').textContent = data.code || '';
      document.getElementById('hero-name').textContent = data.name || data.nameEn || '';
      document.getElementById('hero-tagline').textContent = data.tagline || '';
      
      const tagsContainer = document.getElementById('hero-tags');
      if (data.tags && Array.isArray(data.tags)) {
        tagsContainer.innerHTML = data.tags
          .map(tag => `<span class="tag">${e(tag)}</span>`)
          .join('');
      }

      // ç›®æ¬¡ãƒ‡ãƒ¼ã‚¿åé›†
      const tocItems = [];
      let sectionId = 0;

      // ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ
      let html = '';

      // ç›®æ¬¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¾Œã§å†…å®¹ã‚’åŸ‹ã‚ã‚‹ï¼‰
      html += `<section class="section" id="toc-section">
        <h2 class="section-title">ğŸ“– ç›®æ¬¡</h2>
        <div id="toc-content"></div>
      </section>`;

      // æ¦‚è¦
      if (data.overview) {
        const id = `section-${sectionId++}`;
        tocItems.push({ id, title: 'ã“ã®æ©Ÿèƒ½ã®æœ¬è³ª' });
        html += `<section class="section" id="${id}">
          <h2 class="section-title">ã“ã®æ©Ÿèƒ½ã®æœ¬è³ª</h2>
          <div class="lead">${formatText(data.overview.short || data.overview.oneLiner || '')}</div>`;
        
        if (data.overview.long) {
          html += '<div class="prose">';
          for (const [key, value] of Object.entries(data.overview.long)) {
            const title = {
              essence: 'æœ¬è³ª',
              mechanism: 'ä»•çµ„ã¿',
              comparison: 'ä»–æ©Ÿèƒ½ã¨ã®é•ã„',
              jungView: 'Jungã®è¦‹è§£'
            }[key] || key;
            html += `<h3>${title}</h3>${formatText(value)}`;
          }
          html += '</div>';
        }
        html += '</section>';
      }

      // ç¥çµŒç§‘å­¦çš„åŸºç›¤
      if (data.cognitiveScience) {
        const id = `section-${sectionId++}`;
        tocItems.push({ id, title: 'è„³ç§‘å­¦ã‹ã‚‰è¦‹ãŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ ' });
        html += `<section class="section" id="${id}">
          <h2 class="section-title">è„³ç§‘å­¦ã‹ã‚‰è¦‹ãŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ </h2>`;
        
        if (data.cognitiveScience.neuralBasis) {
          html += `<div class="prose">${formatText(data.cognitiveScience.neuralBasis)}</div>`;
        }
        
        if (data.cognitiveScience.relatedProcesses && Array.isArray(data.cognitiveScience.relatedProcesses)) {
          html += '<div class="prose"><h3>é–¢é€£ã™ã‚‹èªçŸ¥ãƒ—ãƒ­ã‚»ã‚¹</h3></div>';
          data.cognitiveScience.relatedProcesses.forEach(proc => {
            html += `<div class="info-box">
              <div class="info-title">${e(proc.process)}</div>
              <div class="info-content">
                ${formatText(proc.relation)}
                ${proc.research ? `<p><em>å‚è€ƒï¼š${e(proc.research)}</em></p>` : ''}
              </div>
            </div>`;
          });
        }

        // ç§‘å­¦çš„é™ç•Œ
        if (data.cognitiveScience.limitations) {
          html += `<div class="prose"><h3>ã“ã®æ©Ÿèƒ½ã®é™ç•Œã¨è£œå®Œæ–¹æ³•</h3></div>`;
          html += `<div class="warning-box">
            <div class="warning-title">âš  å˜ç‹¬ä½¿ç”¨æ™‚ã®æ½œåœ¨çš„ãªæ‡¸å¿µäº‹é …</div>
            <div class="warning-content">${formatText(data.cognitiveScience.limitations.scientificCaveats || '')}</div>
          </div>`;
          
          if (data.cognitiveScience.limitations.howToCompensate) {
            const comp = data.cognitiveScience.limitations.howToCompensate;
            html += `<div class="info-box">
              <div class="info-title">ğŸ’¡ ${e(comp.title || 'é™ç•Œã‚’è£œã†æ–¹æ³•')}</div>
              <div class="info-content">`;
            
            if (comp.strategies && Array.isArray(comp.strategies)) {
              comp.strategies.forEach(strat => {
                html += `<div style="margin-bottom: 1rem;">
                  <p><strong>${e(strat.limitation)}</strong></p>
                  <p>è£œå®Œæ©Ÿèƒ½ï¼š<strong>${e(strat.compensatingFunction)}</strong></p>
                  ${formatText(strat.integration)}
                </div>`;
              });
            }
            
            if (comp.balancedApproach) {
              html += `<p><strong>ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼š</strong>${formatText(comp.balancedApproach)}</p>`;
            }
            
            html += `</div></div>`;
          }
        }
        
        html += '</section>';
      }

      // ç‰¹æ€§
      if (data.characteristics && Array.isArray(data.characteristics)) {
        const id = `section-${sectionId++}`;
        tocItems.push({ id, title: '5ã¤ã®ç‰¹æ€§' });
        html += `<section class="section" id="${id}">
          <h2 class="section-title">5ã¤ã®ç‰¹æ€§</h2>
          <div class="characteristics">`;
        
        data.characteristics.forEach((char, i) => {
          html += `<div class="characteristic-card">
            <div class="characteristic-title">
              <span class="characteristic-icon">${i + 1}</span>
              <span>${e(char.title || '')}</span>
            </div>
            <p class="characteristic-desc">${formatText(char.description || '')}</p>
            ${char.example ? `<div class="characteristic-example">ä¾‹ï¼š${formatText(char.example)}</div>` : ''}
            ${char.mechanism ? `<p style="margin-top: 0.5rem; font-size: 14px; color: var(--text-muted);"><em>ä»•çµ„ã¿ï¼š${formatText(char.mechanism)}</em></p>` : ''}
          </div>`;
        });
        
        html += '</div></section>';
      }

      // ç°¡æ˜“ãƒ†ã‚¹ãƒˆ
      if (data.userGuidance && data.userGuidance.interactiveElement && data.userGuidance.interactiveElement.quickCheck) {
        const quiz = data.userGuidance.interactiveElement.quickCheck;
        const id = `section-${sectionId++}`;
        tocItems.push({ id, title: 'ç°¡æ˜“ãƒã‚§ãƒƒã‚¯' });
        html += `<section class="section" id="${id}">
          <h2 class="section-title">${e(quiz.title || 'ç°¡æ˜“ãƒã‚§ãƒƒã‚¯')}</h2>
          <div class="quiz-card">
            <div class="quiz-title">${e(quiz.subtitle || 'ä»¥ä¸‹ã®é …ç›®ã«ã„ãã¤å½“ã¦ã¯ã¾ã‚Šã¾ã™ã‹ï¼Ÿ')}</div>
            <div class="quiz-subtitle">${e(quiz.disclaimer || '')}</div>`;
        
        if (quiz.questions && Array.isArray(quiz.questions)) {
          quiz.questions.forEach((q, i) => {
            html += `<div class="quiz-question">
              <input type="checkbox" id="q${i}" class="quiz-checkbox" data-weight="${q.weight || 1}">
              <label for="q${i}" class="quiz-label">${e(q.text)}</label>
            </div>`;
          });
        }
        
        html += `<div class="quiz-result" id="quiz-result">
            <div class="quiz-score" id="quiz-score">0/${quiz.questions.length}</div>
            <div id="quiz-interpretation"></div>
          </div>
        </div>
        </section>`;
      }

      // å¼·ã¿ãƒ»å¼±ã¿
      const swId = `section-${sectionId++}`;
      tocItems.push({ id: swId, title: 'å¼·ã¿ã¨å¼±ã¿' });
      html += `<section class="section" id="${swId}">
        <h2 class="section-title">å¼·ã¿ã¨å¼±ã¿</h2>
        <div class="strengths-weaknesses">
          <div class="sw-card">
            <div class="sw-title"><span>âœ“</span><span>å¼·ã¿</span></div>
            <ul class="sw-list strengths">`;
      
      if (data.strengths && Array.isArray(data.strengths)) {
        data.strengths.forEach(s => {
          html += `<li>${formatText(s)}</li>`;
        });
      }
      
      html += `</ul></div><div class="sw-card">
        <div class="sw-title"><span>âš </span><span>å¼±ã¿</span></div>
            <ul class="sw-list weaknesses">`;
      
      if (data.weaknesses && Array.isArray(data.weaknesses)) {
        data.weaknesses.forEach(w => {
          html += `<li>${formatText(w)}</li>`;
        });
      }
      
      html += `</ul></div></div></section>`;

      // å®Ÿç”Ÿæ´»ã§ã®ä¾‹
      if (data.realLifeExamples) {
        const id = `section-${sectionId++}`;
        tocItems.push({ id, title: 'å®Ÿç”Ÿæ´»ã§ã®ç¾ã‚Œæ–¹' });
        html += `<section class="section" id="${id}">
          <h2 class="section-title">å®Ÿç”Ÿæ´»ã§ã®ç¾ã‚Œæ–¹</h2>
          <div class="examples-grid">`;
        
        for (const [category, examples] of Object.entries(data.realLifeExamples)) {
          if (Array.isArray(examples)) {
            const categoryName = {
              work: 'ä»•äº‹',
              relationships: 'äººé–“é–¢ä¿‚',
              learning: 'å­¦ç¿’',
              hobbies: 'è¶£å‘³ãƒ»ä½™æš‡'
            }[category] || category;
            
            html += `<div class="example-card">
              <div class="example-category">${categoryName}</div>
              <ul class="example-list">`;
            
            examples.forEach(ex => {
              html += `<li>${formatText(ex)}</li>`;
            });
            
            html += `</ul></div>`;
          }
        }
        
        html += `</div></section>`;
      }

      // æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå…¨ã¦è¡¨ç¤ºï¼‰
      if (data.comparisons) {
        const compId = `section-${sectionId++}`;
        tocItems.push({ id: compId, title: 'ä»–ã®æ©Ÿèƒ½ã¨ã®æ¯”è¼ƒ' });
        html += `<section class="section" id="${compId}">
          <h2 class="section-title">ä»–ã®æ©Ÿèƒ½ã¨ã®æ¯”è¼ƒ</h2>`;
        
        // å¯¾æ¥µæ©Ÿèƒ½
        if (data.comparisons.polarOpposite) {
          const comp = data.comparisons.polarOpposite;
          html += `<div class="comparison-card">
            <div class="comparison-header">${e(comp.title || '')}</div>
            <div class="comparison-vs">
              <span class="comparison-function">${data.code}</span>
              <span class="comparison-divider">vs</span>
              <span class="comparison-function">${comp.function}</span>
            </div>`;
          
          if (comp.keyDifferences && Array.isArray(comp.keyDifferences)) {
            html += `<table class="comparison-table">
              <thead>
                <tr>
                  <th>è¦³ç‚¹</th>
                  <th>${data.code}</th>
                  <th>${comp.function}</th>
                </tr>
              </thead>
              <tbody>`;
            
            comp.keyDifferences.forEach(diff => {
              html += `<tr>
                <td><strong>${e(diff.aspect)}</strong></td>
                <td>${formatText(diff[data.code] || '')}</td>
                <td>${formatText(diff[comp.function] || '')}</td>
              </tr>`;
            });
            
            html += `</tbody></table>`;
          }

          if (comp.whenToUseSe || comp.whenToUseNe || comp.whenToUseSi || comp.whenToUseNi) {
            const whenKey = `whenToUse${data.code}`;
            const oppositeKey = `whenToUse${comp.function}`;
            html += `<div class="prose">`;
            if (comp[whenKey] && Array.isArray(comp[whenKey])) {
              html += `<h4>${data.code}ã‚’ä½¿ã†ã¹ãå ´é¢</h4><ul>`;
              comp[whenKey].forEach(w => html += `<li>${formatText(w)}</li>`);
              html += `</ul>`;
            }
            if (comp[oppositeKey] && Array.isArray(comp[oppositeKey])) {
              html += `<h4>${comp.function}ã‚’ä½¿ã†ã¹ãå ´é¢</h4><ul>`;
              comp[oppositeKey].forEach(w => html += `<li>${formatText(w)}</li>`);
              html += `</ul>`;
            }
            html += `</div>`;
          }

          if (comp.integration) {
            html += `<div class="info-box">
              <div class="info-title">ğŸ’¡ çµ±åˆã®ãƒ’ãƒ³ãƒˆ</div>
              <div class="info-content">${formatText(comp.integration)}</div>
            </div>`;
          }

          if (comp.realWorldExample) {
            html += `<div class="info-box">
              <div class="info-title">ğŸŒ å®Ÿä¾‹</div>
              <div class="info-content">${formatText(comp.realWorldExample)}</div>
            </div>`;
          }
          
          html += `</div>`;
        }

        // è£œå®Œé–¢ä¿‚
        if (data.comparisons.complementaryAxis) {
          const comp = data.comparisons.complementaryAxis;
          html += `<div class="comparison-card" style="margin-top: var(--space-lg);">
            <div class="comparison-header">${e(comp.title || '')}</div>
            <div class="prose">
              ${comp.tension ? `<p>${formatText(comp.tension)}</p>` : ''}
            </div>`;
          
          if (comp.conflictScenarios && Array.isArray(comp.conflictScenarios)) {
            html += `<div class="prose"><h4>å¯¾ç«‹ã‚·ãƒ¼ãƒ³</h4></div>`;
            comp.conflictScenarios.forEach(scenario => {
              html += `<div class="info-box">
                <div class="info-title">${e(scenario.situation)}</div>
                <div class="info-content">
                  <p><strong>${data.code}ï¼š</strong>${formatText(scenario[data.code] || scenario.Si || scenario.Se)}</p>
                  <p><strong>${comp.function}ï¼š</strong>${formatText(scenario[comp.function] || scenario.Ne || scenario.Si)}</p>
                </div>
              </div>`;
            });
          }

          if (comp.synergy) {
            html += `<div class="info-box">
              <div class="info-title">ğŸ¤ ã‚·ãƒŠã‚¸ãƒ¼</div>
              <div class="info-content">${formatText(comp.synergy)}</div>
            </div>`;
          }

          if (comp.integration) {
            html += `<div class="info-box">
              <div class="info-title">ğŸ’¡ çµ±åˆã®ãƒ’ãƒ³ãƒˆ</div>
              <div class="info-content">${formatText(comp.integration)}</div>
            </div>`;
          }

          if (comp.famousExample) {
            html += `<div class="info-box">
              <div class="info-title">ğŸŒ å®Ÿä¾‹</div>
              <div class="info-content">${formatText(comp.famousExample)}</div>
            </div>`;
          }
          
          html += `</div>`;
        }

        // åŒã˜æ…‹åº¦ã®æ©Ÿèƒ½
        if (data.comparisons.sameAttitude) {
          const comp = data.comparisons.sameAttitude;
          html += `<div class="comparison-card" style="margin-top: var(--space-lg);">
            <div class="comparison-header">${e(comp.title || '')}</div>
            <div class="prose">
              ${comp.difference ? `<p>${formatText(comp.difference)}</p>` : ''}
            </div>`;
          
          if (comp.strengths) {
            html += `<div class="strengths-weaknesses" style="margin-top: var(--space-lg);">
              <div class="sw-card">
                <div class="sw-title"><span>âœ“</span><span>${data.code}ã®å¼·ã¿</span></div>
                <div class="prose"><p>${formatText(comp.strengths[data.code] || comp.strengths.Se || comp.strengths.Ne)}</p></div>
              </div>
              <div class="sw-card">
                <div class="sw-title"><span>âœ“</span><span>${comp.function}ã®å¼·ã¿</span></div>
                <div class="prose"><p>${formatText(comp.strengths[comp.function] || comp.strengths.Te || comp.strengths.Fe)}</p></div>
              </div>
            </div>`;
          }

          if (comp.collaboration) {
            html += `<div class="info-box">
              <div class="info-title">ğŸ¤ å”åƒ</div>
              <div class="info-content">${formatText(comp.collaboration)}</div>
            </div>`;
          }

          if (comp.realWorldExample) {
            html += `<div class="info-box">
              <div class="info-title">ğŸŒ å®Ÿä¾‹</div>
              <div class="info-content">${formatText(comp.realWorldExample)}</div>
            </div>`;
          }
          
          html += `</div>`;
        }

        html += `</section>`;
      }

      // ã‚¹ã‚¿ãƒƒã‚¯åˆ¥ãƒ€ã‚¤ãƒŠãƒŸã‚¯ã‚¹
      if (data.comparisons && data.comparisons.stackDynamics) {
        const stack = data.comparisons.stackDynamics;
        const stackId = `section-${sectionId++}`;
        tocItems.push({ id: stackId, title: 'æ©Ÿèƒ½ã‚¹ã‚¿ãƒƒã‚¯ã«ãŠã‘ã‚‹å½¹å‰²' });
        html += `<section class="section" id="${stackId}">
          <h2 class="section-title">æ©Ÿèƒ½ã‚¹ã‚¿ãƒƒã‚¯ã«ãŠã‘ã‚‹å½¹å‰²</h2>`;
        
        ['asDominant', 'asAuxiliary', 'asTertiary', 'asInferior'].forEach(position => {
          if (stack[position]) {
            const pos = stack[position];
            const posName = {
              asDominant: 'ä¸»æ©Ÿèƒ½ã¨ã—ã¦',
              asAuxiliary: 'è£œåŠ©æ©Ÿèƒ½ã¨ã—ã¦',
              asTertiary: 'ç¬¬ä¸‰æ©Ÿèƒ½ã¨ã—ã¦',
              asInferior: 'åŠ£ç­‰æ©Ÿèƒ½ã¨ã—ã¦'
            }[position];
            
            html += `<div class="comparison-card" style="margin-bottom: var(--space-lg);">
              <div class="comparison-header">${posName}</div>
              <div class="prose">`;
            
            if (pos.types && Array.isArray(pos.types)) {
              html += `<p><strong>å¯¾è±¡ã‚¿ã‚¤ãƒ—ï¼š</strong>${pos.types.join(', ')}`;
              if (pos.percentage) html += ` <span style="color: var(--text-muted);">(${e(pos.percentage)})</span>`;
              html += `</p>`;
            }
            if (pos.role) {
              html += `<p>${formatText(pos.role)}</p>`;
            }
            if (pos.message) {
              html += `<p><em>${formatText(pos.message)}</em></p>`;
            }
            if (pos.currentState) {
              html += `<p>${formatText(pos.currentState)}</p>`;
            }
            
            html += `</div>`;
            
            if (pos.strengths && Array.isArray(pos.strengths)) {
              html += `<div class="prose"><h4>å¼·ã¿</h4><ul>`;
              pos.strengths.forEach(s => html += `<li>${formatText(s)}</li>`);
              html += `</ul></div>`;
            }
            
            if (pos.challenges && Array.isArray(pos.challenges)) {
              html += `<div class="prose"><h4>èª²é¡Œ</h4><ul>`;
              pos.challenges.forEach(c => html += `<li>${formatText(c)}</li>`);
              html += `</ul></div>`;
            }

            if (pos.developmentFocus) {
              html += `<div class="info-box">
                <div class="info-title">ğŸ¯ ç™ºé”ã®ç„¦ç‚¹</div>
                <div class="info-content">${formatText(pos.developmentFocus)}</div>
              </div>`;
            }

            if (pos.advice) {
              html += `<div class="info-box">
                <div class="info-title">ğŸ’¡ ã‚¢ãƒ‰ãƒã‚¤ã‚¹</div>
                <div class="info-content">${formatText(pos.advice)}</div>
              </div>`;
            }

            if (pos.growthPath) {
              html += `<div class="prose"><h4>æˆé•·ã®é“ç­‹</h4>`;
              if (typeof pos.growthPath === 'object' && !Array.isArray(pos.growthPath)) {
                for (const [key, value] of Object.entries(pos.growthPath)) {
                  html += `<p><strong>${key}ï¼š</strong>${formatText(value)}</p>`;
                }
              } else {
                html += formatText(pos.growthPath);
              }
              html += `</div>`;
            }

            if (pos.practicalAdvice && Array.isArray(pos.practicalAdvice)) {
              html += `<div class="prose"><h4>å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h4><ul>`;
              pos.practicalAdvice.forEach(advice => html += `<li>${formatText(advice)}</li>`);
              html += `</ul></div>`;
            }

            // ã‚·ãƒ£ãƒ‰ã‚¦è¡Œå‹•
            if (pos.shadowBehavior) {
              const shadow = pos.shadowBehavior;
              html += `<div class="warning-box">
                <div class="warning-title">âš  ${e(shadow.title || 'ã‚·ãƒ£ãƒ‰ã‚¦è¡Œå‹•')}</div>
                <div class="warning-content">`;
              
              if (shadow.description) {
                html += `<p>${formatText(shadow.description)}</p>`;
              }
              
              if (shadow.triggers && Array.isArray(shadow.triggers)) {
                html += `<p><strong>ãƒˆãƒªã‚¬ãƒ¼ï¼š</strong></p><ul>`;
                shadow.triggers.forEach(t => html += `<li>${formatText(t)}</li>`);
                html += `</ul>`;
              }
              
              if (shadow.manifestations && Array.isArray(shadow.manifestations)) {
                html += `<p><strong>ç¾ã‚Œæ–¹ï¼š</strong></p>`;
                shadow.manifestations.forEach(m => {
                  html += `<div style="margin-bottom: 1rem;">
                    <p><strong>${e(m.shadow || m.type)}</strong></p>
                    <p>${formatText(m.behavior)}</p>
                    ${m.example ? `<p><em>ä¾‹ï¼š${formatText(m.example)}</em></p>` : ''}
                    ${m.internalization ? `<p><em>${formatText(m.internalization)}</em></p>` : ''}
                  </div>`;
                });
              }

              if (shadow.duration) {
                html += `<p><strong>æŒç¶šæœŸé–“ï¼š</strong>${formatText(shadow.duration)}</p>`;
              }
              
              if (shadow.recovery && Array.isArray(shadow.recovery)) {
                html += `<p><strong>å›å¾©æ–¹æ³•ï¼š</strong></p><ul>`;
                shadow.recovery.forEach(r => html += `<li>${formatText(r)}</li>`);
                html += `</ul>`;
              }

              if (shadow.prevention && Array.isArray(shadow.prevention)) {
                html += `<p><strong>äºˆé˜²ç­–ï¼š</strong></p><ul>`;
                shadow.prevention.forEach(p => html += `<li>${formatText(p)}</li>`);
                html += `</ul>`;
              }
              
              html += `</div></div>`;
            }
            
            html += `</div>`;
          }
        });
        
        html += `</section>`;
      }

      // ã“ã®æ©Ÿèƒ½ã‚’æŒã¤ã‚¿ã‚¤ãƒ—
      if (data.userGuidance && data.userGuidance.ifYouResonateWith && data.userGuidance.ifYouResonateWith.likelyTypes) {
        const types = data.userGuidance.ifYouResonateWith.likelyTypes;
        const typesId = `section-${sectionId++}`;
        tocItems.push({ id: typesId, title: 'ã“ã®æ©Ÿèƒ½ã‚’æŒã¤ã‚¿ã‚¤ãƒ—' });
        html += `<section class="section" id="${typesId}">
          <h2 class="section-title">ã“ã®æ©Ÿèƒ½ã‚’æŒã¤ã‚¿ã‚¤ãƒ—</h2>`;
        
        if (data.userGuidance.ifYouResonateWith.message) {
          html += `<div class="lead">${formatText(data.userGuidance.ifYouResonateWith.message)}</div>`;
        }
        
        html += `<div class="types-grid">`;
        
        types.forEach(type => {
          html += `<div class="type-card">
            <div class="type-header">
              <div class="type-code">${e(type.type)}</div>
              <div class="type-percentage">${e(type.percentage)}</div>
            </div>
            <div class="type-nickname">${e(type.nickname)}</div>
            <div class="type-stack">${e(type.stack)}</div>
            <div class="type-desc">${formatText(type.description)}</div>
            ${type.famousExample ? `<p style="margin-top: 0.5rem; font-size: 12px; color: var(--text-muted);"><em>ä¾‹ï¼š${e(type.famousExample)}</em></p>` : ''}
          </div>`;
        });
        
        html += `</div></section>`;
      }

      // ç™ºé”æ®µéš
      if (data.developmentalStages) {
        const devId = `section-${sectionId++}`;
        tocItems.push({ id: devId, title: 'äººç”Ÿã®ç™ºé”æ®µéš' });
        html += `<section class="section" id="${devId}">
          <h2 class="section-title">äººç”Ÿã®ç™ºé”æ®µéš</h2>
          <div class="stages-grid">`;
        
        for (const [stage, info] of Object.entries(data.developmentalStages)) {
          const stageName = {
            childhood: 'å­ã©ã‚‚æ™‚ä»£',
            adolescence: 'é’å¹´æœŸ',
            adulthood: 'æˆäººæœŸ',
            maturity: 'æˆç†ŸæœŸ'
          }[stage] || stage;
          
          html += `<div class="stage-card">
            <div class="stage-header">
              <div class="stage-title">${stageName}</div>
              ${info.age ? `<div class="stage-age">${e(info.age)}</div>` : ''}
            </div>`;
          
          if (info.characteristics && Array.isArray(info.characteristics)) {
            html += `<div class="prose"><h4>ç‰¹å¾´</h4><ul>`;
            info.characteristics.forEach(c => html += `<li>${formatText(c)}</li>`);
            html += `</ul></div>`;
          }
          
          if (info.challenges && Array.isArray(info.challenges)) {
            html += `<div class="prose"><h4>èª²é¡Œ</h4><ul>`;
            info.challenges.forEach(c => html += `<li>${formatText(c)}</li>`);
            html += `</ul></div>`;
          }

          if (info.support) {
            html += `<div class="info-box">
              <div class="info-title">ğŸ’¡ ã‚µãƒãƒ¼ãƒˆ</div>
              <div class="info-content">${formatText(info.support)}</div>
            </div>`;
          }
          
          if (info.wisdom) {
            html += `<div class="quote-box">
              <p class="quote-text">${formatText(info.wisdom)}</p>
            </div>`;
          }
          
          html += `</div>`;
        }
        
        html += `</div></section>`;
      }

      // å®Ÿç”¨çš„å¿œç”¨ï¼ˆå…¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
      if (data.practicalApplications) {
        const practicalId = `section-${sectionId++}`;
        tocItems.push({ id: practicalId, title: 'å®Ÿç”¨çš„ãªå¿œç”¨æ–¹æ³•' });
        html += `<section class="section" id="${practicalId}">
          <h2 class="section-title">å®Ÿç”¨çš„ãªå¿œç”¨æ–¹æ³•</h2>`;
        
        // ã‚­ãƒ£ãƒªã‚¢
        if (data.practicalApplications.career) {
          const career = data.practicalApplications.career;
          html += `<div class="prose"><h3>ã‚­ãƒ£ãƒªã‚¢</h3>`;
          
          if (career.ideal && Array.isArray(career.ideal)) {
            html += `<h4>é©ã—ãŸè·æ¥­</h4><ul>`;
            career.ideal.forEach(job => html += `<li>${formatText(job)}</li>`);
            html += `</ul>`;
          }
          
          if (career.challenges && Array.isArray(career.challenges)) {
            html += `<h4>ã‚­ãƒ£ãƒªã‚¢ä¸Šã®èª²é¡Œ</h4><ul>`;
            career.challenges.forEach(ch => html += `<li>${formatText(ch)}</li>`);
            html += `</ul>`;
          }
          
          if (career.strategies && Array.isArray(career.strategies)) {
            html += `<h4>æˆ¦ç•¥</h4><ul>`;
            career.strategies.forEach(st => html += `<li>${formatText(st)}</li>`);
            html += `</ul>`;
          }
          
          html += `</div>`;
        }
        
        // å•é¡Œè§£æ±º
        if (data.practicalApplications.problemSolving) {
          const ps = data.practicalApplications.problemSolving;
          html += `<div class="prose"><h3>å•é¡Œè§£æ±º</h3>`;
          
          if (ps.approach) {
            html += `<p>${formatText(ps.approach)}</p>`;
          }
          
          if (ps.process && Array.isArray(ps.process)) {
            html += `<h4>ãƒ—ãƒ­ã‚»ã‚¹</h4><ol>`;
            ps.process.forEach(step => html += `<li>${formatText(step)}</li>`);
            html += `</ol>`;
          }

          if (ps.tips && Array.isArray(ps.tips)) {
            html += `<h4>Tips</h4><ul>`;
            ps.tips.forEach(tip => html += `<li>${formatText(tip)}</li>`);
            html += `</ul>`;
          }

          if (ps.realCase) {
            html += `<div class="info-box">
              <div class="info-title">ğŸŒ å®Ÿä¾‹</div>
              <div class="info-content">${formatText(ps.realCase)}</div>
            </div>`;
          }
          
          html += `</div>`;
        }

        // ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³
        if (data.practicalApplications.communication) {
          const comm = data.practicalApplications.communication;
          html += `<div class="prose"><h3>ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</h3>`;
          
          if (comm.strengths) {
            html += `<p><strong>å¼·ã¿ï¼š</strong>${formatText(comm.strengths)}</p>`;
          }
          
          if (comm.weaknesses) {
            html += `<p><strong>å¼±ã¿ï¼š</strong>${formatText(comm.weaknesses)}</p>`;
          }
          
          if (comm.improvement && Array.isArray(comm.improvement)) {
            html += `<h4>æ”¹å–„æ–¹æ³•</h4><ul>`;
            comm.improvement.forEach(imp => html += `<li>${formatText(imp)}</li>`);
            html += `</ul>`;
          }

          if (comm.example) {
            html += `<div class="info-box">
              <div class="info-title">ğŸ’¬ ä¾‹</div>
              <div class="info-content">${formatText(comm.example)}</div>
            </div>`;
          }
          
          html += `</div>`;
        }

        // äººé–“é–¢ä¿‚
        if (data.practicalApplications.relationships) {
          const rel = data.practicalApplications.relationships;
          html += `<div class="prose"><h3>äººé–“é–¢ä¿‚</h3>`;
          
          if (rel.strengths && Array.isArray(rel.strengths)) {
            html += `<h4>å¼·ã¿</h4><ul>`;
            rel.strengths.forEach(s => html += `<li>${formatText(s)}</li>`);
            html += `</ul>`;
          }
          
          if (rel.challenges && Array.isArray(rel.challenges)) {
            html += `<h4>èª²é¡Œ</h4><ul>`;
            rel.challenges.forEach(c => html += `<li>${formatText(c)}</li>`);
            html += `</ul>`;
          }
          
          if (rel.advice) {
            html += `<div class="info-box">
              <div class="info-title">ğŸ’¡ ã‚¢ãƒ‰ãƒã‚¤ã‚¹</div>
              <div class="info-content">${formatText(rel.advice)}</div>
            </div>`;
          }
          
          html += `</div>`;
        }
        
        html += `</section>`;
      }

      // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
      if (data.trainingProgram) {
        const trainId = `section-${sectionId++}`;
        tocItems.push({ id: trainId, title: 'ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ã‚°ãƒ©ãƒ ' });
        html += `<section class="section" id="${trainId}">
          <h2 class="section-title">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ—ãƒ­ã‚°ãƒ©ãƒ </h2>`;
        
        ['beginner', 'intermediate', 'advanced'].forEach(level => {
          if (data.trainingProgram[level]) {
            const prog = data.trainingProgram[level];
            const levelName = {
              beginner: 'åˆç´š',
              intermediate: 'ä¸­ç´š',
              advanced: 'ä¸Šç´š'
            }[level];
            
            html += `<div class="comparison-card" style="margin-bottom: var(--space-lg);">
              <div class="comparison-header">${levelName}ï¼š${e(prog.level || '')}</div>
              <div class="prose">`;
            
            if (prog.goal) {
              html += `<p><strong>ç›®æ¨™ï¼š</strong>${formatText(prog.goal)}</p>`;
            }
            
            if (prog.duration) {
              html += `<p><strong>æœŸé–“ï¼š</strong>${e(prog.duration)}</p>`;
            }
            
            if (prog.exercises && Array.isArray(prog.exercises)) {
              html += `<h4>ã‚¨ã‚¯ã‚µã‚µã‚¤ã‚º</h4>`;
              prog.exercises.forEach(ex => {
                html += `<div class="info-box">
                  <div class="info-title">${e(ex.name)}</div>
                  <div class="info-content">
                    <p>${formatText(ex.description)}</p>
                    ${ex.frequency ? `<p><em>é »åº¦ï¼š${e(ex.frequency)}</em></p>` : ''}
                  </div>
                </div>`;
              });
            }
            
            html += `</div></div>`;
          }
        });
        
        html += `</section>`;
      }

      // æœ‰åäºº
      if (data.famousPeople && Array.isArray(data.famousPeople)) {
        const famousId = `section-${sectionId++}`;
        tocItems.push({ id: famousId, title: 'ã“ã®æ©Ÿèƒ½ã‚’æŒã¤æœ‰åäºº' });
        html += `<section class="section" id="${famousId}">
          <h2 class="section-title">ã“ã®æ©Ÿèƒ½ã‚’æŒã¤æœ‰åäºº</h2>
          <div class="famous-grid">`;
        
        data.famousPeople.forEach(person => {
          html += `<div class="famous-card">
            <div class="famous-header">
              <div class="famous-name">${e(person.name)}</div>
              ${person.type ? `<div class="famous-type">${e(person.type)}</div>` : ''}
            </div>
            ${person.reason ? `<p class="famous-reason">${formatText(person.reason)}</p>` : ''}
            ${person.quote ? `<div class="famous-quote">"${formatText(person.quote)}"</div>` : ''}
          </div>`;
        });
        
        html += `</div></section>`;
      }

      // Jung ã®è¦–ç‚¹
      if (data.history) {
        const historyId = `section-${sectionId++}`;
        tocItems.push({ id: historyId, title: 'Jung ã®è¦–ç‚¹' });
        html += `<section class="section" id="${historyId}">
          <h2 class="section-title">Jung ã®è¦–ç‚¹</h2>`;
        
        if (data.history.jungQuote) {
          html += `<div class="quote-box">
            <p class="quote-text">${formatText(data.history.jungQuote)}</p>
            ${data.history.jungSource ? `<p class="quote-author">${e(data.history.jungSource)}</p>` : ''}
          </div>`;
        }
        
        if (data.history.context) {
          html += `<div class="prose">${formatText(data.history.context)}</div>`;
        }
        
        if (data.history.warning) {
          html += `<div class="warning-box">
            <div class="warning-title">âš  Jung ã®è­¦å‘Š</div>
            <div class="warning-content">${formatText(data.history.warning)}</div>
          </div>`;
        }

        if (data.history.characteristics) {
          html += `<div class="prose">${formatText(data.history.characteristics)}</div>`;
        }
        
        if (data.history.historicalFigures && Array.isArray(data.history.historicalFigures)) {
          html += `<div class="prose"><h3>æ­´å²ä¸Šã®äººç‰©</h3></div>`;
          data.history.historicalFigures.forEach(fig => {
            html += `<div class="info-box">
              <div class="info-title">${e(fig.name)} ${fig.period ? `ï¼ˆ${e(fig.period)}ï¼‰` : ''}</div>
              <div class="info-content">
                ${fig.contribution ? `<p>${formatText(fig.contribution)}</p>` : ''}
                ${fig.quote ? `<p><em>"${formatText(fig.quote)}"</em></p>` : ''}
              </div>
            </div>`;
          });
        }
        
        html += `</section>`;
      }

      // æ–‡åŒ–çš„æ–‡è„ˆ
      if (data.culturalContext) {
        const cultureId = `section-${sectionId++}`;
        tocItems.push({ id: cultureId, title: 'æ–‡åŒ–çš„æ–‡è„ˆ' });
        html += `<section class="section" id="${cultureId}">
          <h2 class="section-title">æ–‡åŒ–çš„æ–‡è„ˆ</h2>
          <div class="prose">`;
        
        if (data.culturalContext.western) {
          html += `<h3>è¥¿æ´‹ã«ãŠã‘ã‚‹è©•ä¾¡</h3>${formatText(data.culturalContext.western)}`;
        }
        
        if (data.culturalContext.japanese) {
          html += `<h3>æ—¥æœ¬ã«ãŠã‘ã‚‹è©•ä¾¡</h3>${formatText(data.culturalContext.japanese)}`;
        }
        
        if (data.culturalContext.balance) {
          html += `<h3>ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚Šæ–¹</h3>${formatText(data.culturalContext.balance)}`;
        }
        
        html += `</div></section>`;
      }

      // ã‚ˆãã‚ã‚‹èª¤è§£
      if (data.misconceptions && Array.isArray(data.misconceptions)) {
        const misconId = `section-${sectionId++}`;
        tocItems.push({ id: misconId, title: 'ã‚ˆãã‚ã‚‹èª¤è§£' });
        html += `<section class="section" id="${misconId}">
          <h2 class="section-title">ã‚ˆãã‚ã‚‹èª¤è§£</h2>`;
        
        data.misconceptions.forEach((misc, i) => {
          html += `<div class="comparison-card">
            <div class="comparison-header">èª¤è§£ ${i + 1}ï¼š${formatText(misc.myth)}</div>
            <div class="prose">
              <h4>çœŸå®Ÿ</h4>
              ${formatText(misc.truth)}
              ${misc.evidence ? `<p><em>æ ¹æ‹ ï¼š${formatText(misc.evidence)}</em></p>` : ''}
              ${misc.clarification ? `${formatText(misc.clarification)}` : ''}
              ${misc.example ? `<p><em>ä¾‹ï¼š${formatText(misc.example)}</em></p>` : ''}
            </div>
          </div>`;
        });
        
        html += `</section>`;
      }

      // é–¢é€£æ¦‚å¿µ
      if (data.relatedConcepts && Array.isArray(data.relatedConcepts)) {
        const conceptsId = `section-${sectionId++}`;
        tocItems.push({ id: conceptsId, title: 'é–¢é€£ã™ã‚‹å­¦è¡“æ¦‚å¿µ' });
        html += `<section class="section" id="${conceptsId}">
          <h2 class="section-title">é–¢é€£ã™ã‚‹å­¦è¡“æ¦‚å¿µ</h2>`;
        
        data.relatedConcepts.forEach(concept => {
          html += `<div class="info-box">
            <div class="info-title">${e(concept.term)}</div>
            <div class="info-content">
              <p>${formatText(concept.relation)}</p>
              ${concept.reference ? `<p><em>å‚è€ƒï¼š${formatText(concept.reference)}</em></p>` : ''}
            </div>
          </div>`;
        });
        
        html += `</section>`;
      }

      // ã‚¿ã‚¤ãƒ—åˆ¥ç™ºé”ã‚¬ã‚¤ãƒ‰ï¼ˆuserGuidance.forDevelopmentï¼‰
      if (data.userGuidance && data.userGuidance.forDevelopment && data.userGuidance.forDevelopment.byPosition) {
        const devGuideId = `section-${sectionId++}`;
        tocItems.push({ id: devGuideId, title: 'ã‚¿ã‚¤ãƒ—åˆ¥ç™ºé”ã‚¬ã‚¤ãƒ‰' });
        html += `<section class="section" id="${devGuideId}">
          <h2 class="section-title">ã‚¿ã‚¤ãƒ—åˆ¥ç™ºé”ã‚¬ã‚¤ãƒ‰</h2>`;
        
        if (data.userGuidance.forDevelopment.title) {
          html += `<div class="lead">${formatText(data.userGuidance.forDevelopment.title)}</div>`;
        }
        
        const positions = data.userGuidance.forDevelopment.byPosition;
        
        ['dominant', 'auxiliary', 'tertiary', 'inferior'].forEach(position => {
          if (positions[position]) {
            const pos = positions[position];
            const posName = {
              dominant: 'ä¸»æ©Ÿèƒ½',
              auxiliary: 'è£œåŠ©æ©Ÿèƒ½',
              tertiary: 'ç¬¬ä¸‰æ©Ÿèƒ½',
              inferior: 'åŠ£ç­‰æ©Ÿèƒ½'
            }[position];
            
            html += `<div class="comparison-card" style="margin-bottom: var(--space-lg);">
              <div class="comparison-header">${data.code}ãŒ${posName}ã®ã‚ãªãŸã¸</div>`;
            
            if (pos.types && Array.isArray(pos.types)) {
              html += `<p style="text-align: center; margin-bottom: var(--space-md);"><strong>å¯¾è±¡ï¼š${pos.types.join(', ')}</strong></p>`;
            }
            
            html += `<div class="prose">`;
            
            if (pos.message) {
              html += `<p><strong>${formatText(pos.message)}</strong></p>`;
            }
            
            if (pos.currentState) {
              html += `<p>${formatText(pos.currentState)}</p>`;
            }
            
            if (pos.strengths && Array.isArray(pos.strengths)) {
              html += `<h4>ã‚ãªãŸã®å¼·ã¿</h4><ul>`;
              pos.strengths.forEach(s => html += `<li>${formatText(s)}</li>`);
              html += `</ul>`;
            }
            
            if (pos.developmentFocus) {
              html += `<div class="info-box">
                <div class="info-title">ğŸ¯ ç™ºé”ã®ç„¦ç‚¹</div>
                <div class="info-content">${formatText(pos.developmentFocus)}</div>
              </div>`;
            }
            
            if (pos.challenges && Array.isArray(pos.challenges)) {
              html += `<h4>èª²é¡Œ</h4><ul>`;
              pos.challenges.forEach(c => html += `<li>${formatText(c)}</li>`);
              html += `</ul>`;
            }
            
            if (pos.growthPath) {
              html += `<h4>æˆé•·ã®é“ç­‹</h4>`;
              if (typeof pos.growthPath === 'object' && !Array.isArray(pos.growthPath)) {
                for (const [key, value] of Object.entries(pos.growthPath)) {
                  html += `<p><strong>${e(key)}ï¼š</strong>${formatText(value)}</p>`;
                }
              } else {
                html += formatText(pos.growthPath);
              }
            }
            
            if (pos.practicalAdvice && Array.isArray(pos.practicalAdvice)) {
              html += `<h4>å®Ÿè·µçš„ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h4><ul>`;
              pos.practicalAdvice.forEach(advice => html += `<li>${formatText(advice)}</li>`);
              html += `</ul>`;
            }

            if (pos.integration) {
              if (typeof pos.integration === 'object' && !Array.isArray(pos.integration)) {
                html += `<div class="info-box">
                  <div class="info-title">ğŸ’¡ çµ±åˆã«ã¤ã„ã¦</div>
                  <div class="info-content">`;
                if (pos.integration.timing) html += `<p><strong>ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼š</strong>${formatText(pos.integration.timing)}</p>`;
                if (pos.integration.meaning) html += `<p>${formatText(pos.integration.meaning)}</p>`;
                if (pos.integration.caution) html += `<p><em>æ³¨æ„ï¼š${formatText(pos.integration.caution)}</em></p>`;
                html += `</div></div>`;
              }
            }

            if (pos.gripBehavior) {
              const grip = pos.gripBehavior;
              html += `<div class="warning-box">
                <div class="warning-title">âš  ${e(grip.title || 'ã‚°ãƒªãƒƒãƒ—çŠ¶æ…‹')}</div>
                <div class="warning-content">`;
              
              if (grip.triggers && Array.isArray(grip.triggers)) {
                html += `<p><strong>ãƒˆãƒªã‚¬ãƒ¼ï¼š</strong></p><ul>`;
                grip.triggers.forEach(t => html += `<li>${formatText(t)}</li>`);
                html += `</ul>`;
              }
              
              if (grip.symptoms && Array.isArray(grip.symptoms)) {
                html += `<p><strong>ç—‡çŠ¶ï¼š</strong></p><ul>`;
                grip.symptoms.forEach(s => html += `<li>${formatText(s)}</li>`);
                html += `</ul>`;
              }

              if (grip.example) {
                html += `<p><em>ä¾‹ï¼š${formatText(grip.example)}</em></p>`;
              }
              
              html += `</div></div>`;
            }

            if (pos.recovery && Array.isArray(pos.recovery)) {
              html += `<div class="info-box">
                <div class="info-title">ğŸ”„ å›å¾©æ–¹æ³•</div>
                <div class="info-content"><ul>`;
              pos.recovery.forEach(r => html += `<li>${formatText(r)}</li>`);
              html += `</ul></div></div>`;
            }
            
            html += `</div></div>`;
          }
        });
        
        html += `</section>`;
      }

      // HTMLã‚’æŒ¿å…¥
      document.getElementById('main-content').innerHTML = html;

      // ç›®æ¬¡ã‚’ç”Ÿæˆã—ã¦æŒ¿å…¥
      let tocHtml = '<nav class="prose" style="background: var(--bg-secondary); padding: var(--space-lg); border-radius: var(--radius-lg);"><ul style="margin: 0; list-style: none;">';
      tocItems.forEach((item, i) => {
        tocHtml += `<li style="margin-bottom: var(--space-xs);">
          <a href="#${item.id}" style="color: var(--accent-primary); text-decoration: none; font-weight: 500; display: flex; align-items: center; gap: var(--space-xs);">
            <span style="color: var(--text-muted); font-family: var(--font-mono); font-size: 12px; min-width: 24px;">${(i + 1).toString().padStart(2, '0')}</span>
            <span>${e(item.title)}</span>
          </a>
        </li>`;
      });
      tocHtml += '</ul></nav>';
      document.getElementById('toc-content').innerHTML = tocHtml;

      // ç°¡æ˜“ãƒ†ã‚¹ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      if (data.userGuidance && data.userGuidance.interactiveElement && data.userGuidance.interactiveElement.quickCheck) {
        const quiz = data.userGuidance.interactiveElement.quickCheck;
        const checkboxes = document.querySelectorAll('.quiz-checkbox');
        const result = document.getElementById('quiz-result');
        const scoreEl = document.getElementById('quiz-score');
        const interpEl = document.getElementById('quiz-interpretation');
        
        checkboxes.forEach(cb => {
          cb.addEventListener('change', () => {
            const checked = Array.from(checkboxes).filter(c => c.checked).length;
            const total = checkboxes.length;
            scoreEl.textContent = `${checked}/${total}`;
            
            let interpretation = '';
            let scoringData = null;
            
            if (checked >= 4 && quiz.scoring.high) {
              scoringData = quiz.scoring.high;
            } else if (checked >= 2 && quiz.scoring.medium) {
              scoringData = quiz.scoring.medium;
            } else if (quiz.scoring.low) {
              scoringData = quiz.scoring.low;
            }
            
            if (scoringData) {
              interpretation = `<h3>${e(scoringData.result)}</h3>` +
                `<p>${e(scoringData.message)}</p>` +
                `<p><strong>è©²å½“ã‚¿ã‚¤ãƒ—ï¼š</strong>${scoringData.types.join(', ')}</p>` +
                `<p>${e(scoringData.nextAction)}</p>`;
            }
            
            interpEl.innerHTML = interpretation;
            result.classList.add('show');
          });
        });
      }

      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      observeSections();

      console.log('Page rendered successfully');

    } catch (err) {
      console.error('Error:', err);
      document.getElementById('main-content').innerHTML = 
        `<div class="warning-box">
          <div class="warning-title">âš  ã‚¨ãƒ©ãƒ¼</div>
          <div class="warning-content">
            <p>${e(err.message)}</p>
            <p>ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼š</p>
            <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 12px;">${e(err.stack || '')}</pre>
          </div>
        </div>`;
    }
  }

  function e(str) {
    if (!str) return '';
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  function formatText(str) {
    if (!str) return '';
    
    // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    str = e(str);
    
    // Markdowné¢¨ã®å¤ªå­—ã‚’å‡¦ç†ï¼ˆ**text** â†’ <strong>text</strong>ï¼‰
    str = str.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
    
    // æ”¹è¡Œå‡¦ç†ï¼šé€£ç¶šã™ã‚‹æ”¹è¡Œã¯æ®µè½ã€å˜ä¸€æ”¹è¡Œã¯brã‚¿ã‚°
    const paragraphs = str.split(/\n\n+/);
    const formatted = paragraphs.map(p => {
      const withBr = p.replace(/\n/g, '<br>');
      return `<p>${withBr}</p>`;
    }).join('');
    
    return formatted;
  }

  function observeSections() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

    document.querySelectorAll('.section').forEach(section => {
      observer.observe(section);
    });
  }

  loadData();
</script>
</body>
</html>